<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Cypherpunk VPN</title>
    <style>
      html, body { margin: 0; padding: 0; font-family: 'Segoe UI', Arial, Helvetica; font-size: 10pt; background: linear-gradient(#999, #ddd) top / auto 200px repeat-x #ddd; }
      h1 { margin: 0; padding: 0.5em 1em; font-family: 'Segoe UI', Arial, Helvetica; font-weight: bold; font-variant: small-caps; font-size: 11pt; background: #555; color: #ccc; -webkit-app-region: drag; }
      #close { float: right; -webkit-app-region: no-drag; cursor: pointer; }
      #close:hover { color: #fff; }
      body > div { padding: 1em; background: transparent; display: flex; flex-flow: column nowrap; justify-content: center; align-items: center; min-height: 300px; }
      #connect { width: 130px; height: 130px; line-height: 130px; text-align: center; vertical-align: middle; font-size: 16pt; font-weight: bold; border: 5px solid black; border-radius: 20px 60px; background: linear-gradient(rgba(160,160,160,0.4), rgba(160,160,160,1.0)); background-clip: content-box; color: #d53; cursor: pointer; box-shadow: 0 0 150px -5px; }
      #connect:hover { text-shadow: 0 0 10px white; border-color: white; color: white; box-shadow: 0 0 150px 5px; }
      #connect.disconnected { border-color: #d53; color: #d53; background-image: linear-gradient(rgba(224,160,128,0.4), rgba(224,160,128,1.0)); }
      #connect.connected { border-color: #5d3; color: #5d3; background-image: linear-gradient(rgba(160,224,128,0.4), rgba(160,224,128,1.0)); }
      #connect.connecting, #connect.disconnecting { border-color: #555; color: #555; cursor: auto; font-size: 12pt; }
    </style>
  </head>
  <body>
    <h1>Cypherpunk VPN<span id="close" onclick="window.close()">&#10005;</span></h1>
    <div>
      <div id="connect" class="disconnected" style="visibility: hidden">Connect</div>
    </div>
  </body>

  <script>
    // You can also require other files to run in this process
    //require('./renderer.js')

    //require('./js/globals.js');
    //const path = require('path');
    //const exec = require('child_process').exec;
    //const profile = require('./js/profile.js');
    //const importer = require('./js/importer.js');
    //const events = require('./js/events.js');

    var prfl = null;
    
    var connectButton = document.getElementById('connect');

    events.subscribe(function(evt) {
      switch (evt.type) {
        case 'output':
          console.log(evt.data.output);
          return;
        case 'update':
          if (evt.data.id == prfl.id) {
            switch (evt.data.status) {
              case 'connecting':
                connectButton.className = 'connecting';
                connectButton.innerText = 'Connecting...';
                break;
              case 'connected':
                connectButton.className = 'connected';
                connectButton.innerText = 'Disconnect';
                break;
              case 'disconnecting':
                connectButton.className = 'disconnecting';
                connectButton.innerText = 'Disconnecting...';
                break;
              case 'disconnected':
                connectButton.className = 'disconnected';
                connectButton.innerText = 'Connect';
                break;
            }
          }
          break;
          /*
        case "connected":
          connectButton.className = 'connected';
          connectButton.innerText = 'Disconnect';
          break;
        case "disconnected":
          connectButton.className = 'disconnected';
          connectButton.innerText = 'Connect';
          break;
          */
      }
      console.log(evt);
    });

    importer.importProfile(path.join(__dirname, 'cypher.ovpn'), prfls => {
      prfl = prfls[0];
      document.getElementById("connect").style.visibility = 'visible';
    });

    //const prfl = new profile.Profile(path.join(__dirname, 'cypher'));
    //prfl.load(() => {
    //  document.getElementById("connect").style.visibility = 'visible';
    //}, true);

    document.getElementById("connect").addEventListener('click', function() {
      let elm = this;

      

      if (elm.className == 'disconnected') {
        prfl.connect();
        elm.className = 'connecting';
        elm.innerText = 'Connecting...';
      } else if (elm.className == 'connected') {
        prfl.disconnect();
        elm.className = 'disconnected';
        elm.innerText = 'Disconnecting...';
      }

      
      //const prfl = importer.importProfile(path.join(__dirname, 'cypher.ovpn'), prfls => {
      //  debugger;
      //});

      /*
      let elm = this;
      if (this.className=='disconnected') {
        this.innerText='Connected';
        this.className='connected';
        const child = exec('calc', (error, stdout, stderr) => {
          if (error !== null) {
            window.alert("Failed to load");
          }
          elm.innerText='Closed';
          elm.className='disconnected';
        });
      } else {
        this.innerText='Connect';
        this.className='disconnected';
      }
      */
    });
  </script>
</html>
